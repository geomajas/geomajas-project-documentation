<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<!--
  ~ This file is part of Geomajas, a component framework for building
  ~ rich Internet applications (RIA) with sophisticated capabilities for the
  ~ display, analysis and management of geographic information.
  ~ It is a building block that allows developers to add maps
  ~ and other geographic data capabilities to their web applications.
  ~
  ~ Copyright 2008-2010 Geosparc, http://www.geosparc.com, Belgium
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<chapter id="release" lang="en">
  <title>How to release Geomajas</title>

  <para>Several steps need to be performed on the gaya server. This procedure
  expects that you have logged in to the gaya server, with the
  <code>geomajas</code> user account. Do not use the root user!</para>

  <orderedlist numeration="arabic">
    <listitem>
      <para>Make sure your subversion password and settings are defined in
      your home directory: <code>~/.m2/settings.xml</code>. Check if this file
      exists. If it does not, create it, and give it the following
      content:<programlisting>&lt;settings&gt;
    &lt;servers&gt;
        &lt;server&gt;
            &lt;id&gt;svn.geomajas.org&lt;/id&gt;
            &lt;username&gt;your-login&lt;/username&gt;
            &lt;password&gt;your-password&lt;/password&gt;
        &lt;/server&gt;
    &lt;/servers&gt;
&lt;/settings&gt;</programlisting></para>
    </listitem>

    <listitem>
      <para>Set release version, make sure this is correct!</para>

      <programlisting>export VERSION=<replaceable>1.5.0</replaceable></programlisting>
    </listitem>

    <listitem>
      <para>Checkout Geomajas trunk:</para>

      <programlisting>svn checkout https://svn.geomajas.org/majas/trunk tmpgeomajas
cd tmpgeomajas</programlisting>
    </listitem>

    <listitem>
      <para>Let maven do the release, this will ask for the release version,
      subversion tag name and next version for each of the modules. The
      "release:prepare" asks the release version, tag name for the release and
      next version. Change the tag name to just be the version number (without
      "geomajas-all" in prefix). <programlisting>mvn clean install -Dhudson
mvn release:prepare -DautoVersionSubmodules=true -DreleaseVersion=$VERSION -Dtag=$VERSION
sudo chmod -R 775 /var/www/maven.geomajas.org/htdocs/repository/org/geomajas/
sudo chmod -R 777 /var/www/files.geomajas.org/htdocs/maven/trunk/
cd ..
rm -rf tmpgeomajas</programlisting></para>
    </listitem>

    <listitem>
      <para>Now that the preparation is over, the actual tag has been created.
      We will now check out that tag:</para>

      <programlisting>svn checkout https://svn.geomajas.org/majas/tags/$VERSION geomajas-$VERSION
cd geomajas-$VERSION</programlisting>
    </listitem>

    <listitem>
      <para>Next step is to deploy the newly created tag.</para>

      <programlisting>mvn deploy -Dhudson</programlisting>

      <para>The files are now deployed in our maven repository, but the index
      needs to be rebuilt. So log into <ulink
      url="http://apps.geomajas.org/nexus/">nexus</ulink> go to repositories,
      right click on the "3rd party" repository and indicate both "Re-index"
      and "Rebuild metadata":</para>

      <screenshot>
        <screeninfo>Nexus re-index and rebuild metadata</screeninfo>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="../resources/nexus_re_index.png" />
          </imageobject>
        </mediaobject>
      </screenshot>
    </listitem>

    <listitem>
      <para>Build the maven site:<programlisting>mvn -Pnoshrink -DskipTests site-deploy</programlisting></para>
    </listitem>

    <listitem>
      <para>copy maven site to correct location for the version (replace
      "x.x.x" with correct version number), <programlisting>cp -R /var/www/files.geomajas.org/htdocs/maven/trunk /var/www/files.geomajas.org/htdocs/maven/$VERSION</programlisting>This
      will make the documentation available at
      <code>http://files.geomajas.org/maven/x.x.x/geomajas/index.html</code>.</para>
    </listitem>

    <listitem>
      <para>Create zip files for source and documentation.</para>

      <programlisting>cd ..
rm -Rf geomajas-$VERSION
svn checkout https://svn.geomajas.org/majas/tags/$VERSION geomajas-$VERSION
zip -r geomajas-$VERSION.zip . -x .svn 
rm -R geomajas-$VERSION
cp -R /var/www/files.geomajas.org/htdocs/maven/$VERSION geomajas-$VERSION
zip -r geomajas-doc-$VERSION.zip .  
rm -Rf geomajas-$VERSION
sudo chmod -R 775 /var/www/files.geomajas.org/htdocs/maven/trunk/
sudo chmod -R 775 /var/www/maven.geomajas.org/htdocs/repository/org/geomajas/</programlisting>
    </listitem>

    <listitem>
      <para>Upload zip files to sourceforge download area</para>
    </listitem>

    <listitem>
      <para>JIRA : Assure the next version exists, mark the current version as
      released agreeing to move open issue to the next version.</para>
    </listitem>

    <listitem>
      <para>For unstable release : install gwt-example for online trial</para>
    </listitem>

    <listitem>
      <para>For stable release : install all demo application for online
      trial</para>
    </listitem>

    <listitem>
      <para>Announce :</para>

      <para><itemizedlist>
          <listitem>
            <para>Build announcement message using the following template
            :</para>

            <blockquote>
              <para>title : Geomajas <emphasis>1.5.0</emphasis>
              <emphasis>technology preview/release candidate/stable
              </emphasis> released</para>

              <para></para>

              <para>The Geomajas project is proud to release Geomajas 1.5.0, a
              technology preview showcasing the progress we are making towards
              our next stable build.</para>

              <para>The major advances in this version include
              <emphasis>(indicate major contributors when
              appropriate)</emphasis></para>

              <itemizedlist>
                <listitem>
                  <para>modularization of the system</para>
                </listitem>

                <listitem>
                  <para>introduction of a GWT face</para>
                </listitem>
              </itemizedlist>

              <para>For the full list of changes, see
              http://jira.geomajas.org/jira/secure/ReleaseNote.jspa?version=10131&amp;styleName=Html&amp;projectId=10000&amp;Create=Create</para>

              <para>Documentation for this release can be found at
              http://files.geomajas.org/maven/1.5.0/geomajas/userguide.html
              .</para>

              <para>Download links can be found at
              http://geomajas.org/release_1.5.0 .</para>

              <para>For the next release we plan to include the following
              features</para>

              <itemizedlist>
                <listitem>
                  <para>absorb CO2 from the air to reduce global
                  warming</para>
                </listitem>

                <listitem>
                  <para>remove need for system to be powered</para>
                </listitem>
              </itemizedlist>

              <para></para>

              <para>Please note that this is an unstable release, all the new
              features since the previous stable release may still change and
              we some new bugs may have been introduced.</para>

              <para>If you want to help us, join the discussions on the
              developer list, list bugs in jira and make feature requests in
              our fora. See http://www.geomajas.org/gis-development .</para>

              <para></para>

              <para>Geomajas is the extensible open source web mapping
              framework, enabling integrated GIS solutions for businesses and
              government.</para>
            </blockquote>

            <para>Feel free to change wording and add useful content.</para>
          </listitem>

          <listitem>
            <para>Create download image for this version (278x61
            pixels).</para>
          </listitem>

          <listitem>
            <para>Add release on download page (remember to name the page
            "release_1.5.0" with correct version number).</para>
          </listitem>

          <listitem>
            <para>For a stable release, update the documentation page.</para>
          </listitem>

          <listitem>
            <para>For a stable release, update Geomajas wikipedia page.</para>
          </listitem>

          <listitem>
            <para>Send announcement to majas-dev (plain text).</para>
          </listitem>

          <listitem>
            <para>Publish on general forum.</para>
          </listitem>

          <listitem>
            <para>Create news item (without the "Geomajas is..."
            footer.</para>
          </listitem>

          <listitem>
            <para>Send mail to jan.pote@geosparc.com to assure Geosparc is
            informed of the release.</para>
          </listitem>
        </itemizedlist></para>
    </listitem>
  </orderedlist>
</chapter>
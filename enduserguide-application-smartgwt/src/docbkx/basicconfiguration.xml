<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ This is part of Geomajas, a GIS framework, http://www.geomajas.org/.
  ~
  ~ Copyright 2008-2013 Geosparc nv, http://www.geosparc.com/, Belgium.
  ~
  ~ The program is available in open source according to the GNU Affero
  ~ General Public License. All contributions in this program are covered
  ~ by the Geomajas Contributors License Agreement. For full licensing
  ~ details, see LICENSE.txt in the project root.
  -->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<chapter id="basic_configuration" lang="en">
  <title>Basic configuration</title>

  <para>This section explains how to configure a number of pre-installed functionality, data layers, widgets and security in the example application.</para>

	<section id="structure">
		<title>Configuration files structure</title>
        <para>The configuration is done in XML files. Depending on the installation you chose you can find the configuration files under ROOT/WEB-INF.
        </para>

        <itemizedlist>
            <listitem>
                <para>Stand-alone application (.zip) : ROOT = installation-directory/webapps/geomajas/</para>
            </listitem>
            <listitem>
                <para>Web archive (.war) : ROOT = war file</para>
            </listitem>
        </itemizedlist>

        <para>The WEB-INF folder contains most important configuration files. The following scheme shows how the configuration files are structured</para>
		<mediaobject>
			<imageobject>
				<imagedata fileref="images/WEB-INF-folder.png" scale="100%" />
			</imageobject>
		</mediaobject>

        <orderedlist>
            <listitem>
                <para>Folder "layer" - contains layer configuration files including SLDs.</para>
            </listitem>
            <listitem>
                <para>Folder "map" - contains mapMain.xml which handles the configuration for the map. Here you can define which widgets should be used, which data layers should be included, etc.</para>
            </listitem>
            <listitem>
                <para>Folder "widget" - contains widget configuration files for the Legend, the Ribbon Toolbar and the Theme Selector.</para>
            </listitem>
            <listitem>
                <para>File "security.xml" - allows you to define the security settings for the application.</para>
            </listitem>
        </orderedlist>

	</section>

    <section id="layers">
        <title>Layer configuration</title>

        <section id="layerStructure">
            <title>General</title>
            <para>In the example application the layers are grouped by supported layer type (OSM, SHP, TMS, WFS and WMS). The scheme below shows the configured layers per layer type in the "layers" folder. Also a set of SLD files for the layers are stored.
            </para>

            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/Layer-folder.png" scale="100%" />
                </imageobject>
            </mediaobject>

            <para>For each layer 2 configuration files are required:
            </para>

            <itemizedlist>
                <listitem>
                    <para>layerNAME.xml : server-side layer configuration defines the layer type, the data source, the geometry type, the CRS of the source, the bounding box, the layer attributes and the SLD file.</para>
                </listitem>
                <listitem>
                    <para>clientLayerNAME.xml : client-side layer configuration defines layer name, the minimum and maximum zoom level the layer is visible, etc.</para>
                </listitem>
            </itemizedlist>
        </section>

        <section id="layerSwitching">
            <title>Turning pre-configured layers on/off</title>

            <para>The layers that are pre-configured in the example application can be switched on and off in the mapMain.xml file (property "layers"). Uncomment a line in order to enable the layer in the application. Put the line in comments when you want to disable a layer.</para>
            <para>In the example below, there are seven layers configured, but only three are enabled in the application. The other 4 layers are commented out.</para>

            <programlisting language="xml">
<![CDATA[<property name="layers">
    <list>
        <ref bean="clientLayerOsm" />
        <!-- <ref bean="clientLayerSimplifiedCountriesTms" /> -->
        <!-- <ref bean="clientLayerSimplifiedCountriesWms" /> -->
        <!--<ref bean="clientLayerSimplifiedCountriesWfs" /> -->
        <!--<ref bean="clientLayerCountries" /> -->
        <ref bean="clientLayerCountriesWithFlag" />
        <ref bean="clientLayerCities" />
    </list>
</property>]]>
            </programlisting>

            <para>The order in which the layers are drawn on the map is defined by the reverse order in the mapMain.xml. In the example above, the OSM layer would be drawn first. The layer CountriesWithFlag would be drawn on top of the first one, etc.</para>

            <note>
                <para>Once you have enabled/disabled a layer, make sure to also include/exclude it from the layer tree!</para>
                <para>How this is done is explained in <xref linkend="widgets"/></para>
            </note>
        </section>

        <section id="layerStyle">
            <title>Changing the layer style</title>

            <para>The layer style for vector layers (SHP, WFS) is defined using Styled Layer Descriptor (SLD) files. The pre-configured SLD files can be found in the ROOT/WEB-INF/layer folder.</para>
            <para>The server-side layer configuration file defines which SLD file is used to define the layer style. This is done using the NamedStyleInfo and the property "sldLocation".</para>
            <para>In the Example below (extract from the server-side configuration file layerCountriesWithFlag.xml) one can see that the layerCountriesWithFlagPopulation.sld is used for styling. This value could be replaced with for example layerCountriesWithFlagRegions.sld to apply another style.</para>

            <programlisting language="xml">
<![CDATA[<bean class="org.geomajas.configuration.NamedStyleInfo" name="layerCountriesWithFlagStyleInfo">
    <property name="sldLocation" value="WEB-INF/layer/layerCountriesWithFlagPopulation.sld" />
</bean>]]>
            </programlisting>

            <note>
                <para>More detailed information about layer styling using SLD can be found <ulink url="http://docs.geoserver.org/latest/en/user/styling/index.html">here</ulink>.</para>
            </note>

        </section>
    </section>

    <section id="widgets">
        <title>Widget configuration</title>

        <para>The example application has 3 Geomajas widgets configured: the Ribbon Toolbar, the Layer Tree and the Advanced Views.  In this section we will only cover the basic configuration for the Layer Tree. Learn more about widget configuration in the advanced configuration SECTION??? or check the Geomajas plug-in documentation.</para>
        <para>The Layer Tree widget configuration is defined in ROOT/WEB-INF/widget/layerTree.xml. The configuration below shows how the different layers are ordered in the layer tree. The ordering of the layers in the tree is defined by the sequence in the configuration file. Layers can be included/excluded from the layer tree by (un)commenting them.</para>
        <programlisting language="xml">
<![CDATA[<property name="treeNodes">
    <list>
        <bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerOsm" />
        </bean>
        <!-- <bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerSimplifiedCountriesTms" />
        </bean> -->
        <!--<bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerSimplifiedCountriesWms" />
        </bean> -->
        <!-- <bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerSimplifiedCountriesWfs" />
        </bean> -->
        <!--<bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerCountries" />
        </bean> -->
        <bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerCountriesWithFlag" />
        </bean>
        <bean class="org.geomajas.widget.layer.configuration.client.ClientLayerNodeInfo">
            <property name="layerId" value="clientLayerCities" />
        </bean>
    </list>
</property>]]>
        </programlisting>

        <para>In the example above, there are 3 layers configured in the layer tree: OSM, the Cities layer and the CountriesWithFlag layer. The others are commented out and hence not included in the layer tree. The order in the layer tree can be configured completely independent from the rendering order.</para>
    </section>

</chapter>